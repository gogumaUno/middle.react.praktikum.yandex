(this["webpackJsonpreact-messenger"]=this["webpackJsonpreact-messenger"]||[]).push([[0],[,,,,,,,function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},,,,,,,function(e,t,a){e.exports=a(33)},,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n,r=a(0),s=a.n(r),c=a(11),i=a.n(c),o=(a(19),a(6)),u=a(5),l=a(1),m=a.n(l),h=a(2),g=a(3),d=a(4),f=a(13),v=a(12),p={chat:{avatar:{cardIcon:"Chat icon",messageAuthor:"Author avatar",default:"Avatar"},messages:{serviceMessage:"service-message",messageWrap:"message-wrap"}}},y=(a(21),function(e){var t=e.className,a=e.src,n=e.alt,r=void 0===n?p.chat.avatar.default:n;return s.a.createElement("div",{className:t},s.a.createElement("img",{src:a,alt:r}))}),C=(a(22),function(e){var t=e.chatName,a=e.lastMessageDate;return s.a.createElement("div",{className:"card-meta"},s.a.createElement("div",{className:"card-meta__name"},s.a.createElement("span",null,t)),s.a.createElement("div",{className:"card-meta__date"},s.a.createElement("span",null,a)))}),E=(a(23),function(e){var t=e.author,a=e.message;return s.a.createElement("div",{className:"card-message"},s.a.createElement("span",{className:"card-message__author"},t,":"),s.a.createElement("span",{className:"card-message__content"},a))}),b=function(e){return e>=10?e:"0".concat(e)},S={getDate:function(e){var t=new Date(e),a=b(t.getDate()),n=b(t.getMonth()+1),r=b(t.getFullYear());return"".concat(a,"/").concat(n,"/").concat(r)},getTime:function(e){var t=new Date(e),a=b(t.getHours()),n=b(t.getMinutes()),r=b(t.getSeconds());return"".concat(a,":").concat(n,":").concat(r)},removeTimeFromTimestamp:function(e){return new Date(e).setHours(0,0,0,0)},getServiceMessage:function(e){return new Date(e).toDateString()}},N=(a(24),function(e){var t=e.guid,a=e.logo,n=e.name,r=e.lastMessage,c=e.isSelected,i=e.onChatSelected,o=S.getDate(r.timestamp);return s.a.createElement("button",{className:"card-wrap button-reset",onClick:function(){return i(t)},type:"button"},s.a.createElement("section",{className:"card ".concat(c?"selected":"")},s.a.createElement("section",{className:"card__body"},s.a.createElement(y,{className:"card__logo",src:a,alt:p.chat.avatar.cardIcon}),s.a.createElement("section",{className:"card__info"},s.a.createElement(C,{chatName:n,lastMessageDate:o}),s.a.createElement(E,{author:r.author.name,message:r.content})))))}),k=function(e){var t=e.chatList,a=e.selectedChat,n=e.onChatSelected;return s.a.createElement("section",null,t.map((function(e){var t=a===e.guid;return s.a.createElement(N,Object.assign({},e,{isSelected:t,onChatSelected:n,key:e.guid}))})))},j=(a(25),function(e){var t=e.onChatSelected,a=e.selectedChat,n=e.className,r=e.chatList;return s.a.createElement("aside",{className:"sidebar ".concat(n)},s.a.createElement(k,{onChatSelected:t,selectedChat:a,chatList:r}))}),w=(a(26),function(e){var t=e.className,a=void 0===t?p.chat.messages.messageWrap:t,n=e.children;return s.a.createElement("div",null,s.a.createElement("div",{className:a},n))}),O=(a(27),function(e){var t=e.timestamp;return s.a.createElement(w,{className:p.chat.messages.serviceMessage},s.a.createElement("span",{className:"service-message__date"},S.getServiceMessage(t)))}),_=(a(28),function(e){var t=e.author,a=e.content,n=e.timestamp;return s.a.createElement(w,null,s.a.createElement("section",{style:{position:"relative"},className:"message"},s.a.createElement(y,{className:"message__icon",src:t.avatar,alt:p.chat.avatar.messageAuthor}),s.a.createElement("div",{className:"message__body"},s.a.createElement("span",{className:"message__author"},t.name),s.a.createElement("div",{className:"message__content"},s.a.createElement("span",null,a))),s.a.createElement("div",{className:"message__time"},s.a.createElement("span",null,S.getTime(n)))))});!function(e){e[e.Service=0]="Service",e[e.Text=1]="Text"}(n||(n={}));a(29);var M=function(e){var t=e.messageList;return s.a.createElement("div",{className:"message-history"},t.map((function(e){switch(e.type){case n.Service:return s.a.createElement(O,Object.assign({key:e.guid},e));case n.Text:default:return s.a.createElement(_,Object.assign({key:e.guid},e))}})))},I=(a(30),function(e){var t=e.onChatClosed,a=e.messageList,n=e.className;return s.a.createElement("div",{className:"content ".concat(n)},s.a.createElement("button",{className:"close-chat-button button-reset",onClick:t,type:"button"},"X"),s.a.createElement(M,{messageList:a}))}),T=a(8),L=a(34);function D(e){var t=1+Math.random()*e;return Math.floor(t)}var x=a(7),H=a.n(x);function B(e,t){return e.reduce((function(e,a,n){return e[a]=t(a,n),e}),{})}function z(e,t){return function(){return function(e,t){for(var a,r,s=D(e.length-1),c=[],i=0;i<=s;i+=1){var o=Object(L.a)(),u=t[D(t.length-1)],l=e[D(e.length-1)],m=(a=new Date(2020,0,1),r=new Date,new Date(a.getTime()+Math.random()*(r.getTime()-a.getTime())).getTime());c.push({guid:o,authorId:u,content:l,timestamp:m,type:n.Text})}return c}(e,t)}}var A=function(){function e(){Object(g.a)(this,e),this.userStorage={},this.chatStorage={},this.messageStorage={},this.initialized=!1}return Object(d.a)(e,[{key:"init",value:function(){var e=Object(h.a)(m.a.mark((function e(){var t,n,r,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.e(3).then(a.t.bind(null,35,3));case 2:t=e.sent,n=t.chatNames,r=t.usernames,s=t.messages,this.initializeStorage(n,r,s),this.initialized=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeStorage",value:function(e,t,a){this.userStorage=B(t.map((function(){return Object(L.a)()})),function(e){return function(t,a){return{guid:t,name:e[a],avatar:H.a}}}(t)),this.chatStorage=B(e.map((function(){return Object(L.a)()})),function(e){return function(t,a){return{guid:t,name:e[a],logo:H.a}}}(e)),this.messageStorage=B(Object.keys(this.chatStorage),z(a,Object.keys(this.userStorage)))}},{key:"getUserById",value:function(e){return this.userStorage[e]}},{key:"getChats",value:function(){return this.chatStorage}},{key:"getMessages",value:function(){return this.messageStorage}},{key:"getChatHistoryByChatId",value:function(e){return this.messageStorage[e]}},{key:"checkIfInitialized",value:function(){return this.initialized?Promise.resolve():this.init()}}]),e}(),W=new(function(){function e(t){Object(g.a)(this,e),this.storage=t}return Object(d.a)(e,[{key:"getChatList",value:function(){var e=Object(h.a)(m.a.mark((function e(){var t,a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.checkIfInitialized();case 2:return t=this.storage.getChats(),a=this.storage.getMessages(),n=this.mapToChatInfo(t,a),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChatHistoryByChatId",value:function(){var e=Object(h.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.checkIfInitialized();case 2:return a=this.storage.getChatHistoryByChatId(t),e.abrupt("return",this.mapToMessage(a));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"mapToMessage",value:function(e){var t=this;return e.map((function(e){var a=e.authorId,n=Object(T.a)(e,["authorId"]);return Object(u.a)({},n,{author:t.storage.getUserById(a)})}))}},{key:"mapToChatInfo",value:function(e,t){var a=this;return Object.keys(e).map((function(n){var r=e[n],s=t[r.guid],c=s[s.length-1],i=c.authorId,o=Object(T.a)(c,["authorId"]);return Object(u.a)({},r,{lastMessage:Object(u.a)({},o,{author:a.storage.getUserById(i)})})}))}}]),e}())(new A),F={sortByDate:function(e,t){return e>t?-1:e<t?1:0}},U={addServiceMessageToChatHistory:function(e){var t=new Set;return e.reduce((function(e,a){var r=S.removeTimeFromTimestamp(a.timestamp);return t.has(r)||(t.add(r),e.push({guid:Object(L.a)(),timestamp:r,type:n.Service})),e.push(a),e}),[])}},J=(a(31),function(e){Object(f.a)(a,e);var t=Object(v.a)(a);function a(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(g.a)(this,a),(e=t.call(this,n)).onChatSelected=function(t){e.setState({selectedChat:t},(function(){return e.loadChatHistory()}))},e.onChatClosed=function(){e.setState({selectedChat:""})},e.state={selectedChat:"",chatList:[],chatHistory:{}},e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=Object(h.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.getChatList();case 2:t=e.sent,this.setState({chatList:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMessageList",value:function(){var e=this.state,t=e.selectedChat,a=e.chatHistory[t];return U.addServiceMessageToChatHistory(a||[])}},{key:"getSortedChatList",value:function(){return this.state.chatList.sort((function(e,t){return F.sortByDate(e.lastMessage.timestamp,t.lastMessage.timestamp)}))}},{key:"loadChatHistory",value:function(){var e=this,t=this.state,a=t.selectedChat,n=t.chatHistory;n[a]||W.getChatHistoryByChatId(a).then((function(t){return e.setState({chatHistory:Object(u.a)({},n,Object(o.a)({},a,t))})}))}},{key:"render",value:function(){var e=this.state.selectedChat,t=this.getSortedChatList(),a=this.getMessageList();return s.a.createElement("main",{className:"layout"},s.a.createElement(j,{className:"".concat(e?"hidden":"displayed"),onChatSelected:this.onChatSelected,selectedChat:e,chatList:t}),s.a.createElement(I,{className:"".concat(e?"displayed":"hidden"),onChatClosed:this.onChatClosed,messageList:a}))}}]),a}(r.Component));a(32);var P=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(J,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(P,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[14,1,2]]]);
//# sourceMappingURL=main.36d1ff66.chunk.js.map